# 건강기능식품 리뷰 팩트체크 시스템
## 프로젝트 최종 결과 보고서

**작성일**: 2026-01-16
**작성자**: 로직 디자이너 (팀원 B)
**프로젝트 버전**: v1.0.0

---

# Part 1: 프로젝트 개요

## 1.1 배경 및 문제 정의

온라인 건강기능식품 시장의 급성장과 함께 **광고성 허위 리뷰**가 사회적 문제로 대두되고 있습니다. 소비자들은 제품 구매 전 리뷰를 참고하지만, 협찬/광고 리뷰와 실사용자 리뷰를 구분하기 어려운 상황입니다.

**핵심 문제**:
- 광고성 리뷰의 범람으로 인한 소비자 신뢰도 하락
- 과장된 효능 주장으로 인한 건강 피해 우려
- 객관적인 리뷰 검증 시스템의 부재

## 1.2 프로젝트 목표

> **"리뷰의 진위 여부를 가리고, 약사의 시각으로 요약한다."**

1. **정량적 신뢰도 평가**: 8단계 체크리스트 기반 수치화
2. **AI 전문가 분석**: Claude AI 약사 페르소나 활용
3. **시각적 대시보드**: Streamlit 기반 직관적 UI 제공

## 1.3 팀 구성 및 역할

| 역할 | 담당 영역 | 주요 산출물 |
|------|----------|------------|
| **기획자** | 요구사항 정의, 사용자 시나리오 | SPEC.md, 기획서 |
| **DB 담당자 (팀원 A)** | 데이터 수집, Supabase 구축 | products/reviews 테이블, 스크래핑 |
| **로직 디자이너 (팀원 B)** | 검증 로직, AI 분석 엔진 | checklist.py, trust_score.py, analyzer.py |
| **UI 개발자 (팀원 C)** | Streamlit 대시보드, 시각화 | app.py, visualizations.py |

---

# Part 2: 핵심 기술 (로직 디자이너 관점)

## 2.1 "리뷰의 진위 여부를 어떻게 판별하는가?"

로직 디자이너로서 설계한 핵심 알고리즘은 **3단계 검증 파이프라인**입니다:

```
┌─────────────────────────────────────────────────────────────────────┐
│                         리뷰 검증 파이프라인                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   [리뷰 입력] ──▶ [13단계 체크리스트] ──▶ [신뢰도 점수 계산] ──▶ [AI 분석]  │
│                        │                      │                     │
│                   광고 패턴 탐지          가중치 기반 점수화       약사 페르소나   │
│                   정규표현식 매칭          감점 적용              전문가 인사이트   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 2.2 13단계 광고 판별 체크리스트 알고리즘

### 핵심 파일: `logic_designer/checklist.py`

**AdChecklist 클래스**가 13가지 광고 의심 패턴을 정규표현식 기반으로 탐지합니다.

### 체크리스트 항목 및 탐지 로직

| # | 항목명 | 탐지 방식 | 패턴 예시 |
|---|--------|----------|----------|
| 1 | 대가성 문구 존재 | 정규표현식 | `r"무상.*제공"`, `r"협찬"` |
| 2 | 감탄사 남발 | 정규표현식 | `r"[!!!!]{3,}"`, `r"(완전\|진짜){2,}"` |
| 3 | 정돈된 문단 구조 | 정규표현식 | `r"^[0-9]\."`, `r"^•\s"` |
| 4 | 개인 경험 부재 | 키워드 존재 여부 | "나는", "저는", "직접" 부재 시 |
| 5 | 원료 특징 나열 | 정규표현식 + DB | `r"(mg\|g\|mcg).{0,20}(mg\|g)"` |
| 6 | 키워드 반복 | 빈도 분석 | 동일 단어 7회 이상 반복 |
| 7 | 단점 회피 | 부정 키워드 부재 | "단점", "아쉬움" 부재 시 |
| 8 | 찬사 위주 구성 | 정규표현식 | `r"(최고\|강추){2,}"` |
| 9 | 전문 용어 오남용 | 정규표현식 + DB | `r"(항산화\|면역력){2,}"` |
| 10 | 비현실적 효과 강조 | 정규표현식 | `r"(100%\|완벽).*(효과\|개선)"` |
| 11 | 타사 제품 비교 | 정규표현식 | `r"(다른\|타사).*제품.*(비해)"` |
| 12 | 홍보성 블로그 문체 | 정규표현식 | `r"~했답니다"`, `r"~추천드려요"` |
| 13 | 이모티콘 과다 사용 | 정규표현식 | 이모티콘 5개 이상 연속 |

### 핵심 코드 스니펫

```python
# logic_designer/checklist.py (Line 127-215)
class AdChecklist:
    """13단계 광고 판별 체크리스트 클래스"""

    def check_ad_patterns(
        self,
        review_text: str,
        product_id: Optional[int] = None
    ) -> Dict[int, str]:
        """
        13단계 광고 판별 체크리스트 검사 (영양성분 DB 통합)

        Returns:
            Dict[int, str]: {항목번호: 항목명} 형태로 감지된 항목 반환
        """
        detected_issues = {}

        for item_num, item_data in self.AD_PATTERNS.items():
            name = item_data["name"]
            patterns = item_data["patterns"]

            # 특수 케이스: 개인 경험 부재 (4번)
            if item_num == 4:
                if not self._has_personal_experience(review_text):
                    detected_issues[item_num] = name
                continue

            # 특수 케이스: 키워드 반복 (6번)
            if item_num == 6:
                threshold = 7  # 임계값 완화 (5→7)
                if self._has_keyword_repetition(review_text, threshold):
                    detected_issues[item_num] = name
                continue

            # 정규표현식 패턴 매칭
            for pattern in patterns:
                if re.search(pattern, review_text, re.IGNORECASE | re.MULTILINE):
                    detected_issues[item_num] = name
                    break

        return detected_issues
```

### 개선 이력 (2026-01-07)

**문제**: Supabase 통합 테스트 결과, 정상 리뷰의 **오탐률**이 높았음
- "개인 경험 부재": 15개 중 13개 감지 (86.7%)
- "단점 회피": 15개 중 11개 감지 (73.3%)
- 평균 신뢰도 점수: 47.54점 (목표 50점 미달)

**해결책**:
1. 개인 경험 패턴 대폭 확장 (구매/사용/체감/재구매 표현 추가)
2. 단점 회피 로직 완화 (다른 광고 패턴과 함께 있을 때만 감점)
3. 키워드 반복 임계값 완화 (5회 → 7회)

---

## 2.3 신뢰도 점수 계산 공식

### 핵심 파일: `logic_designer/trust_score.py`

**TrustScoreCalculator 클래스**가 가중치 기반 점수를 계산합니다.

### 점수 계산 공식

#### 기본 공식 (영양성분 점수 없을 때)
```
S = (L × 0.2) + (R × 0.2) + (M × 0.3) + (P × 0.1) + (C × 0.2)
```

#### 확장 공식 (영양성분 DB 통합 시)
```
S = (L × 0.15) + (R × 0.15) + (M × 0.25) + (P × 0.1) + (C × 0.15) + (N × 0.2)
```

| 변수 | 의미 | 가중치 (기본) | 가중치 (확장) |
|------|------|--------------|--------------|
| L | 리뷰 길이 점수 | 0.2 | 0.15 |
| R | 재구매 여부 점수 | 0.2 | 0.15 |
| M | 한달 사용 여부 점수 | **0.3** | 0.25 |
| P | 사진 첨부 점수 | 0.1 | 0.1 |
| C | 내용 일치도 점수 | 0.2 | 0.15 |
| N | 영양성분 일치도 점수 | - | **0.2** |

**설계 근거**: 한달 사용 여부(M)에 가장 높은 가중치를 부여한 이유는, 건강기능식품의 특성상 장기 복용 후에야 체감 효과를 알 수 있기 때문입니다.

### 감점 적용 로직

```python
# logic_designer/trust_score.py (Line 71-85)
def apply_penalty(self, base_score: float, penalty_count: int, penalty_per_item: int = 10) -> float:
    """
    감점 적용

    Args:
        base_score: 기본 점수
        penalty_count: 감점 항목 개수 (체크리스트에서 감지된 항목 수)
        penalty_per_item: 항목당 감점 점수 (기본값: 10)

    Returns:
        float: 감점 적용 후 최종 점수 (0 이상)
    """
    penalty = penalty_count * penalty_per_item
    final_score = max(0, base_score - penalty)
    return round(final_score, 2)
```

### 광고 판별 기준

```python
# logic_designer/trust_score.py (Line 234-247)
def is_ad(self, final_score: float, penalty_count: int, threshold: float = 40) -> bool:
    """
    광고 여부 판별

    조건:
    - 40점 미만 → 광고
    - 감점 항목 3개 이상 → 광고
    """
    return final_score < threshold or penalty_count >= 3
```

---

## 2.4 AI 약사 페르소나 분석

### 핵심 파일: `logic_designer/analyzer.py`

**PharmacistAnalyzer 클래스**가 Claude AI를 활용하여 전문가 수준의 분석을 제공합니다.

### 시스템 프롬프트 설계

```python
# logic_designer/analyzer.py (Line 21-67)
SYSTEM_PROMPT = """당신은 15년 경력의 임상 약사입니다.

**역할 및 태도:**
- 전문적이고 객관적인 관점에서 리뷰를 분석합니다
- 보수적인 태도로 과장된 표현을 경계합니다
- 일반 사용자도 이해할 수 있도록 명확하게 설명합니다
- **제품의 실제 영양성분 정보를 기반으로 분석합니다**

**엄격한 제약 조건:**
1. 리뷰 원문에 명시된 내용만 분석하세요
2. 리뷰에 없는 성분이나 효능을 추측하거나 추가하지 마세요
3. 모호하거나 불확실한 정보는 '판단 불가'로 처리하세요
4. 의학적 진단이나 처방을 하지 마세요
5. **제공된 영양성분 정보와 리뷰 내용을 비교하여 일치 여부를 확인하세요**

**출력 형식:**
반드시 다음 JSON 형식으로 응답하세요:
{
  "summary": "리뷰 한 줄 요약 (사용자 체감 중심, 30자 이내)",
  "efficacy": "효능 관련 내용 (원문 근거만, 공식 효능과 비교)",
  "side_effects": "부작용 관련 내용",
  "tip": "약사의 핵심 조언 (50자 이내, 영양성분 정보 기반)"
}
"""
```

### API 호출 로직

```python
# logic_designer/analyzer.py (Line 147-161)
response = self.client.messages.create(
    model="claude-sonnet-4-5-20250929",
    max_tokens=1000,
    temperature=0.3,  # 일관성 있는 분석을 위해 낮은 temperature
    system=self.SYSTEM_PROMPT,
    messages=[
        {
            "role": "user",
            "content": user_prompt
        }
    ]
)
```

**temperature=0.3 선택 이유**: 의료/건강 분야의 특성상 일관성과 정확성이 중요하므로, 창의성보다 신뢰성을 우선시했습니다.

---

## 2.5 영양성분 DB 통합 (고급 기능)

### 핵심 파일: `logic_designer/nutrition_utils.py`

식품의약품안전처 영양성분 DB를 활용하여 **허위 성분 주장**을 탐지합니다.

### 성분 추출 패턴

```python
# logic_designer/nutrition_utils.py (Line 47-114)
ingredient_patterns = [
    # 비타민류
    r'비타민\s*[A-Z]?\d*',
    r'Vitamin\s*[A-Z]?\d*',

    # 카로티노이드
    r'루테인', r'제아잔틴', r'리코펜', r'베타카로틴',
    r'Lutein', r'Zeaxanthin', r'Lycopene',

    # 오메가
    r'오메가\s*3', r'Omega\s*3', r'DHA', r'EPA',

    # 프로바이오틱스
    r'프로바이오틱스', r'Probiotic',
    r'락토바실러스', r'비피도박테리움',

    # 미네랄
    r'칼슘', r'마그네슘', r'아연', r'셀레늄'
]
```

### 허위 주장 검증 로직

```python
# logic_designer/checklist.py (Line 360-394)
def _validate_ingredient_claims(self, review_text: str, product_id: Optional[int] = None) -> bool:
    """
    리뷰에서 언급된 성분이 실제 제품에 포함되어 있는지 검증

    Returns:
        bool: 허위 성분 주장이 있으면 True (광고 의심)
    """
    nutrition_info = get_nutrition_info_safe(product_id)
    if not nutrition_info:
        return False  # 정보 없으면 검증 생략

    mentioned_ingredients = extract_ingredients(review_text)

    for mentioned in mentioned_ingredients:
        if not is_valid_ingredient(mentioned, nutrition_info):
            return True  # 허위 주장 발견

    return False
```

---

# Part 3: 시스템 데모

## 3.1 핵심 화면 구성

### 메인 대시보드 (app.py)

| 영역 | 기능 | 구현 파일 |
|------|------|----------|
| 사이드바 | 제품 선택, 필터, 통계 | `app.py:703-987` |
| Hero Metrics | 핵심 지표 한눈에 | `app.py:1161-1209` |
| 레이더 차트 | 다차원 비교 | `visualizations.py:28-54` |
| 비교표 | 세부 지표 정렬 | `visualizations.py:83-120` |
| 리뷰 딥다이브 | 개별 리뷰 분석 | `app.py:573-659` |

### 사용자 흐름

```
1. 브랜드/제품 선택 (사이드바)
       ↓
2. 비교 제품 자동 추천 (최대 3개)
       ↓
3. 신뢰도 점수 확인 (게이지 차트)
       ↓
4. 8단계 체크리스트 상세 확인
       ↓
5. AI 약사 인사이트 확인
       ↓
6. 개별 리뷰 팩트체크
```

## 3.2 8단계 체크리스트 시각화

### 체크리스트 결과 예시 (UI)

```
✅ 인증 구매 비율     ████████████████████░░░░  80%
✅ 재구매율           ████████████░░░░░░░░░░░░  45%
✅ 장기 사용 비율     ██████████████████░░░░░░  68%
✅ 평점 분포 적절성   ████████████████████████  92%
❌ 리뷰 길이          ████████░░░░░░░░░░░░░░░░  35%
✅ 시간 분포 자연성   ████████████████████░░░░  85%
✅ 광고성 리뷰 탐지   ██████████████████████░░  90%
❌ 리뷰어 다양성      ██████████░░░░░░░░░░░░░░  48%
```

---

# Part 4: 기술 스택 및 아키텍처

## 4.1 기술 스택 상세

| 영역 | 기술 | 버전 | 용도 |
|------|------|------|------|
| **Frontend** | Streamlit | 1.31.0+ | 웹 대시보드 |
| **시각화** | Plotly | 5.18.0+ | 차트 (레이더, 게이지, 막대) |
| **AI 분석** | Anthropic Claude | Sonnet 4.5 | 약사 페르소나 분석 |
| **데이터베이스** | Supabase | PostgreSQL | 제품/리뷰 저장 |
| **데이터 처리** | Pandas | 2.1.0+ | 데이터 변환/통계 |
| **언어** | Python | 3.8+ | 전체 구현 |

## 4.2 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              시스템 아키텍처                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────┐     ┌─────────────────────────────────────┐               │
│  │  Streamlit  │────▶│         ui_integration/             │               │
│  │   Browser   │     │  app.py, visualizations.py          │               │
│  └─────────────┘     └───────────────┬─────────────────────┘               │
│                                      │                                      │
│                                      ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                         logic_designer/                              │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │   │
│  │  │ checklist.py│  │trust_score  │  │ analyzer.py │  │ validator.py│ │   │
│  │  │ AdChecklist │  │ Calculator  │  │ Pharmacist  │  │ Review      │ │   │
│  │  │ 13단계 탐지  │  │ 점수 계산   │  │ AI 분석     │  │ Validator   │ │   │
│  │  └─────────────┘  └─────────────┘  └──────┬──────┘  └─────────────┘ │   │
│  └───────────────────────────────────────────┼─────────────────────────┘   │
│                                              │                              │
│                      ┌───────────────────────┼───────────────────────┐     │
│                      ▼                       ▼                       ▼     │
│           ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐   │
│           │    Supabase     │    │  Claude AI API  │    │ 영양성분 DB │   │
│           │ (PostgreSQL)    │    │  (Anthropic)    │    │ (식약처)    │   │
│           │ products/reviews│    │  Sonnet 4.5     │    │             │   │
│           └─────────────────┘    └─────────────────┘    └─────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 4.3 데이터베이스 스키마

### products 테이블

```sql
CREATE TABLE products (
    id          SERIAL PRIMARY KEY,
    name        TEXT NOT NULL,
    brand       TEXT NOT NULL,
    price       DECIMAL(10, 2),
    rating_avg  DECIMAL(3, 2),
    rating_count INTEGER,
    category    TEXT,
    product_url TEXT,
    created_at  TIMESTAMP DEFAULT NOW()
);
```

### reviews 테이블

```sql
CREATE TABLE reviews (
    id              SERIAL PRIMARY KEY,
    product_id      INTEGER REFERENCES products(id),
    text            TEXT NOT NULL,
    rating          INTEGER CHECK (rating >= 1 AND rating <= 5),
    reviewer        TEXT,
    verified        BOOLEAN DEFAULT FALSE,
    reorder         BOOLEAN DEFAULT FALSE,
    one_month_use   BOOLEAN DEFAULT FALSE,
    date            DATE,
    language        TEXT DEFAULT 'ko',
    helpful_count   INTEGER DEFAULT 0,
    created_at      TIMESTAMP DEFAULT NOW()
);
```

---

# Part 5: 성과 및 향후 계획

## 5.1 정량적 성과

| 지표 | 목표 | 달성 | 비고 |
|------|------|------|------|
| 제품 수 | 5개 | **30개** | 카테고리 확장 |
| 리뷰 수 | 100개 | **510개** | 제품당 17개 평균 |
| 평균 신뢰도 점수 | 50점 | **65점** | 알고리즘 개선 후 |
| 체크리스트 오탐률 | <20% | **15%** | 임계값 조정 후 |
| AI 분석 응답 시간 | <5초 | **<3초** | temperature 최적화 |
| UI 렌더링 시간 | <3초 | **<2초** | 데이터 캐싱 적용 |

## 5.2 핵심 기술적 성과 (로직 디자이너 관점)

### 1. 13단계 광고 판별 체크리스트 완성
- **정규표현식 기반** 패턴 매칭 알고리즘 설계
- **빈도 분석** 기반 키워드 반복 탐지
- **영양성분 DB 연동**으로 허위 주장 검증

### 2. 신뢰도 점수 공식 설계 및 검증
- **가중치 기반** 종합 점수 산출
- **감점 시스템** 설계 (항목당 -10점)
- **광고 판별 임계값** 설정 (40점 / 3개 항목)

### 3. AI 약사 페르소나 프롬프트 엔지니어링
- **15년 경력 임상 약사** 페르소나 구현
- **JSON 출력 형식** 일관성 확보
- **부인 공지** 자동 삽입으로 법적 리스크 최소화

## 5.3 개발 과정 주요 마일스톤

| 날짜 | 마일스톤 | 산출물 |
|------|----------|--------|
| 2026-01-03 | 사용자 시나리오 정의 | 사용자_시나리오_업데이트.md |
| 2026-01-05 | Supabase DB 설계 | schema.sql, 테이블 생성 |
| 2026-01-07 | 체크리스트 개선 | checklist.py (임계값 조정) |
| 2026-01-08 | 영양성분 DB 통합 | nutrition_utils.py |
| 2026-01-12 | UI/UX 대폭 개선 | app.py, visualizations.py |
| 2026-01-14 | 최종 점검 완료 | DB 연동 최종 점검 |

## 5.4 한계점

1. **데이터 한계**: iHerb 루테인 제품 5종 → 30종으로 확장했으나, 다양한 카테고리 커버 필요
2. **언어 한계**: 한국어/영어 중심 → 다국어 지원 필요
3. **실시간 업데이트**: 스크래핑 1회성 → 주기적 업데이트 필요
4. **AI 비용**: Claude API 호출 비용 → 캐싱/배치 처리 최적화 필요

## 5.5 향후 개선 방향

### 단기 (1-2개월)
- [ ] 다국어 리뷰 분석 지원 (일본어, 중국어)
- [ ] 실시간 스크래핑 파이프라인 구축
- [ ] AI 분석 결과 캐싱 시스템

### 중기 (3-6개월)
- [ ] 리뷰어 패턴 분석 (동일 리뷰어 다중 제품 리뷰 탐지)
- [ ] 이미지 분석 기능 (리뷰 사진 진위 검증)
- [ ] 사용자 신고 시스템 연동

### 장기 (6개월+)
- [ ] 다른 플랫폼 확장 (쿠팡, 네이버 쇼핑)
- [ ] B2B API 서비스화
- [ ] 모바일 앱 개발

---

# 부록

## A. 주요 파일 위치 및 역할

| 파일 | 경로 | 역할 |
|------|------|------|
| `checklist.py` | `logic_designer/` | 13단계 광고 판별 체크리스트 |
| `trust_score.py` | `logic_designer/` | 신뢰도 점수 계산기 |
| `analyzer.py` | `logic_designer/` | AI 약사 페르소나 분석 |
| `validator.py` | `logic_designer/` | 리뷰 종합 검증 |
| `nutrition_utils.py` | `logic_designer/` | 영양성분 DB 유틸리티 |
| `product_criteria.py` | `logic_designer/` | 제품별 체크 기준 |
| `app.py` | `ui_integration/` | Streamlit 메인 앱 |
| `visualizations.py` | `ui_integration/` | 시각화 컴포넌트 |
| `supabase_data.py` | `ui_integration/` | Supabase 데이터 연동 |

## B. 환경 설정

### .streamlit/secrets.toml
```toml
SUPABASE_URL = "https://xxx.supabase.co"
SUPABASE_ANON_KEY = "your-anon-key"
ANTHROPIC_API_KEY = "your-anthropic-api-key"
```

### 실행 명령어
```bash
cd ui_integration
streamlit run app.py
```

## C. 개발일지 목록 (총 44건)

상세 내용은 `개발일지/` 폴더 참조

---

**보고서 작성 완료**
**작성일**: 2026-01-16
**로직 디자이너**
